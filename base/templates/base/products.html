{% extends "base/base.html" %}

{% block content %}
<div class="row">
    <h2>Produits</h2>
</div>
<div class="row">
    <h6>
	Cette page sert √† :
	 <ul>
	  <li>cr√©er un nouveau produit ;</li>
	  <li>obtenir des informations sur les produits.</li>
	</ul>
    Pour pouvoir cr√©er un nouveau produit, il faut au pr√©alable que le fournisseur, la cat√©gorie du produit et les unit√©s aient √©t√© cr√©√©es.
	</h6>
</div>
</br>
<div class="row justify-content-center">
  <a class="btn btn-info" href="{% url 'base:create_product' %}">Cr√©er un nouveau produit</a>
</div>

<div id="vue-table">

    <div class ="row">
	<div class="text-right filter">
	    <input type="text" v-model="search" class="form-control" placeholder="Tapez pour filtrer ...">
	</div>
	<div class="text-right filter">
	    <button @click="changeVisible" class="btn btn-secondary">[[ only_visible ? "Montrer " : "Masquer "]] les non visibles </button>
	</div>
    </div>

  <table class="table table-striped">
    <thead>
      <tr>
        <th v-for="column in columns" @click="sortBy(column)" :class="{ active: sortKey == column }">
	  [[ _.capitalize(column) ]]
	  [[ sortKey == column ? (reverse ? "‚ØÖ" : "‚ØÜ") : ""]]
        </th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="x in filter()">
        <td v-for="column in columns">
	  [[ x[column] ]]
	</td>
        <td><a :href="'produit/' + x.id">‚å¨ D√©tails</a></td>
        <td><a :href="'stats/' + x.id"><!-- Áµ±Ë®à --> üìà Stats</a></td>
      </tr>
    </tbody>
  </table>

</div>

<script>
  new Vue({
      delimiters: ['[[', ']]'],
      el: '#vue-table',
      data: {
	  sortKey: 'nom',
	  only_visible: true,
	  search: '',
	  reverse: false,
	  columns: {{ columns | safe }},
	  raw_data: {{ pdts | safe }}
      },

      computed: {
	  orderedData: function () {
	      var data = _.orderBy(this.raw_data, this.sortKey);
	      if (this.reverse) {
		  return _.reverse(data)
	      } else {
		  return data
	      }
	  }
      },

      methods: {
	  changeVisible: function() {
	      this.only_visible = !this.only_visible
	  },

	  sortBy: function(sortKey) {
	      this.reverse = (this.sortKey == sortKey) ? ! this.reverse : false;
	      this.sortKey = sortKey
	  },

	  filter: function () {
	      var search = this.search;
	      var only_visible = this.only_visible;
	      return _.pickBy(this.orderedData, (function (row) {
		  var b = (!only_visible) || (row.visible == "‚úî");
		  return b && (myContains(row.nom, search) || myContains(row.cat√©gorie, search) || myContains(row.fournisseur, search))
	      }))
	  }
      }
  })
</script>
{% endblock %}
